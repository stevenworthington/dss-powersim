<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 R | dss-powersim</title>
  <meta name="description" content="This is a tutorial for power simulation" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="4 R | dss-powersim" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a tutorial for power simulation" />
  <meta name="github-repo" content="IQSS/dss-powersim" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 R | dss-powersim" />
  
  <meta name="twitter:description" content="This is a tutorial for power simulation" />
  

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="power-of-what.html"/>
<link rel="next" href="python.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Power Simulation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Simulation-Based Power Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#table-of-contents"><i class="fa fa-check"></i>Table of Contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="part"><span><b>I Concepts</b></span></li>
<li class="chapter" data-level="1" data-path="power-analysis.html"><a href="power-analysis.html"><i class="fa fa-check"></i><b>1</b> Power Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="power-analysis.html"><a href="power-analysis.html#canned-routines"><i class="fa fa-check"></i><b>1.1</b> Canned routines</a></li>
<li class="chapter" data-level="1.2" data-path="power-analysis.html"><a href="power-analysis.html#step-by-step"><i class="fa fa-check"></i><b>1.2</b> Step by step</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>2</b> Simulation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="simulation.html"><a href="simulation.html#customization"><i class="fa fa-check"></i><b>2.1</b> Customization</a></li>
<li class="chapter" data-level="2.2" data-path="simulation.html"><a href="simulation.html#step-by-step-1"><i class="fa fa-check"></i><b>2.2</b> Step by step</a></li>
</ul></li>
<li class="part"><span><b>II Preparation</b></span></li>
<li class="chapter" data-level="3" data-path="power-of-what.html"><a href="power-of-what.html"><i class="fa fa-check"></i><b>3</b> Power of What?</a>
<ul>
<li class="chapter" data-level="3.1" data-path="power-of-what.html"><a href="power-of-what.html#study-design"><i class="fa fa-check"></i><b>3.1</b> Study design</a></li>
<li class="chapter" data-level="3.2" data-path="power-of-what.html"><a href="power-of-what.html#mixed-effects-model"><i class="fa fa-check"></i><b>3.2</b> Mixed effects model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="power-of-what.html"><a href="power-of-what.html#step-1-model-specification"><i class="fa fa-check"></i><b>3.2.1</b> Step 1: model specification</a></li>
<li class="chapter" data-level="3.2.2" data-path="power-of-what.html"><a href="power-of-what.html#step-2-variable-composition"><i class="fa fa-check"></i><b>3.2.2</b> Step 2: Variable composition</a></li>
<li class="chapter" data-level="3.2.3" data-path="power-of-what.html"><a href="power-of-what.html#step-3-parameter-composition"><i class="fa fa-check"></i><b>3.2.3</b> Step 3: Parameter composition</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Implementation</b></span></li>
<li class="chapter" data-level="4" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>4</b> R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="r.html"><a href="r.html#setup"><i class="fa fa-check"></i><b>4.1</b> Setup</a></li>
<li class="chapter" data-level="4.2" data-path="r.html"><a href="r.html#data-simulation-step-by-step"><i class="fa fa-check"></i><b>4.2</b> Data simulation step by step</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="r.html"><a href="r.html#establish-the-data-generating-parameters"><i class="fa fa-check"></i><b>4.2.1</b> Establish the data-generating parameters</a></li>
<li class="chapter" data-level="4.2.2" data-path="r.html"><a href="r.html#simulate-the-sampling-process"><i class="fa fa-check"></i><b>4.2.2</b> Simulate the sampling process</a></li>
<li class="chapter" data-level="4.2.3" data-path="r.html"><a href="r.html#simulate-the-sampling-of-songs"><i class="fa fa-check"></i><b>4.2.3</b> Simulate the sampling of songs</a></li>
<li class="chapter" data-level="4.2.4" data-path="r.html"><a href="r.html#simulate-the-sampling-of-subjects"><i class="fa fa-check"></i><b>4.2.4</b> Simulate the sampling of subjects</a></li>
<li class="chapter" data-level="4.2.5" data-path="r.html"><a href="r.html#check-the-simulated-values"><i class="fa fa-check"></i><b>4.2.5</b> Check the simulated values</a></li>
<li class="chapter" data-level="4.2.6" data-path="r.html"><a href="r.html#simulate-trials"><i class="fa fa-check"></i><b>4.2.6</b> Simulate trials</a></li>
<li class="chapter" data-level="4.2.7" data-path="r.html"><a href="r.html#calculate-response-values"><i class="fa fa-check"></i><b>4.2.7</b> Calculate response values</a></li>
<li class="chapter" data-level="4.2.8" data-path="r.html"><a href="r.html#plot-the-data"><i class="fa fa-check"></i><b>4.2.8</b> Plot the data</a></li>
<li class="chapter" data-level="4.2.9" data-path="r.html"><a href="r.html#analyze-the-simulated-data"><i class="fa fa-check"></i><b>4.2.9</b> Analyze the simulated data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="r.html"><a href="r.html#data-simulation-automated"><i class="fa fa-check"></i><b>4.3</b> Data simulation automated</a></li>
<li class="chapter" data-level="4.4" data-path="r.html"><a href="r.html#power-calculation-single-run"><i class="fa fa-check"></i><b>4.4</b> Power calculation (single run)</a></li>
<li class="chapter" data-level="4.5" data-path="r.html"><a href="r.html#power-calculation-automated"><i class="fa fa-check"></i><b>4.5</b> Power calculation automated</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="r.html"><a href="r.html#check-false-positive-rate"><i class="fa fa-check"></i><b>4.5.1</b> Check false positive rate</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="r.html"><a href="r.html#power-for-different-effect-sizes"><i class="fa fa-check"></i><b>4.6</b> Power for different effect sizes</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="r.html"><a href="r.html#summarize"><i class="fa fa-check"></i><b>4.6.1</b> Summarize</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="python.html"><a href="python.html"><i class="fa fa-check"></i><b>5</b> Python</a>
<ul>
<li class="chapter" data-level="5.1" data-path="python.html"><a href="python.html#simple-linear-regression"><i class="fa fa-check"></i><b>5.1</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="python.html"><a href="python.html#setup-1"><i class="fa fa-check"></i><b>5.1.1</b> Setup</a></li>
<li class="chapter" data-level="5.1.2" data-path="python.html"><a href="python.html#step-4-simulate"><i class="fa fa-check"></i><b>5.1.2</b> Step 4: Simulate</a></li>
<li class="chapter" data-level="5.1.3" data-path="python.html"><a href="python.html#step-5-automate"><i class="fa fa-check"></i><b>5.1.3</b> Step 5: Automate</a></li>
<li class="chapter" data-level="5.1.4" data-path="python.html"><a href="python.html#step-6-summarize"><i class="fa fa-check"></i><b>5.1.4</b> Step 6: Summarize</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="python.html"><a href="python.html#mixed-effects-model-1"><i class="fa fa-check"></i><b>5.2</b> Mixed effects model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="python.html"><a href="python.html#step-4-simulate-1"><i class="fa fa-check"></i><b>5.2.1</b> Step 4: Simulate</a></li>
<li class="chapter" data-level="5.2.2" data-path="python.html"><a href="python.html#step-5-automate-1"><i class="fa fa-check"></i><b>5.2.2</b> Step 5: Automate</a></li>
<li class="chapter" data-level="5.2.3" data-path="python.html"><a href="python.html#step-6-summarize-1"><i class="fa fa-check"></i><b>5.2.3</b> Step 6: Summarize</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stata.html"><a href="stata.html"><i class="fa fa-check"></i><b>6</b> Stata</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stata.html"><a href="stata.html#simple-linear-regression-1"><i class="fa fa-check"></i><b>6.1</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="stata.html"><a href="stata.html#setup-2"><i class="fa fa-check"></i><b>6.1.1</b> Setup</a></li>
<li class="chapter" data-level="6.1.2" data-path="stata.html"><a href="stata.html#step-4-simulate-2"><i class="fa fa-check"></i><b>6.1.2</b> Step 4: Simulate</a></li>
<li class="chapter" data-level="6.1.3" data-path="stata.html"><a href="stata.html#step-5-automate-2"><i class="fa fa-check"></i><b>6.1.3</b> Step 5: Automate</a></li>
<li class="chapter" data-level="6.1.4" data-path="stata.html"><a href="stata.html#step-6-summarize-2"><i class="fa fa-check"></i><b>6.1.4</b> Step 6: Summarize</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stata.html"><a href="stata.html#mixed-effects-model-2"><i class="fa fa-check"></i><b>6.2</b> Mixed effects model</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stata.html"><a href="stata.html#setup-3"><i class="fa fa-check"></i><b>6.2.1</b> Setup</a></li>
<li class="chapter" data-level="6.2.2" data-path="stata.html"><a href="stata.html#step-4-simulate-3"><i class="fa fa-check"></i><b>6.2.2</b> Step 4: Simulate</a></li>
<li class="chapter" data-level="6.2.3" data-path="stata.html"><a href="stata.html#step-5-automate-3"><i class="fa fa-check"></i><b>6.2.3</b> Step 5: Automate</a></li>
<li class="chapter" data-level="6.2.4" data-path="stata.html"><a href="stata.html#step-6-summarize-3"><i class="fa fa-check"></i><b>6.2.4</b> Step 6: Summarize</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="7" data-path="software-comparison.html"><a href="software-comparison.html"><i class="fa fa-check"></i><b>7</b> Software Comparison</a></li>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i>Resources</a>
<ul>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html#r-1"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="resources.html"><a href="resources.html#stata-1"><i class="fa fa-check"></i>Stata</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> R<a href="r.html#r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="setup" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Setup<a href="r.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The main library we will use is <code>stats</code> and comes bundled with base R. However, we also need to install a few additional libraries onto our machine and then load them into our search path.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="r.html#cb3-1" tabindex="-1"></a><span class="co"># uncomment the line below to install the {pacman} library on your computer</span></span>
<span id="cb3-2"><a href="r.html#cb3-2" tabindex="-1"></a><span class="co"># install.packages(&quot;pacman&quot;)</span></span>
<span id="cb3-3"><a href="r.html#cb3-3" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb3-4"><a href="r.html#cb3-4" tabindex="-1"></a>  lme4,        <span class="co"># model specification / estimation</span></span>
<span id="cb3-5"><a href="r.html#cb3-5" tabindex="-1"></a>  lmtest,      <span class="co"># likelihood ratio tests</span></span>
<span id="cb3-6"><a href="r.html#cb3-6" tabindex="-1"></a>  faux,        <span class="co"># simulate from multivariate normal distribution</span></span>
<span id="cb3-7"><a href="r.html#cb3-7" tabindex="-1"></a>  afex,        <span class="co"># anova and deriving p-values from lmer</span></span>
<span id="cb3-8"><a href="r.html#cb3-8" tabindex="-1"></a>  broom.mixed, <span class="co"># extracting tidy data from model fits</span></span>
<span id="cb3-9"><a href="r.html#cb3-9" tabindex="-1"></a>  tidyverse,   <span class="co"># data wrangling and visualisation</span></span>
<span id="cb3-10"><a href="r.html#cb3-10" tabindex="-1"></a>  gt           <span class="co"># nice tables</span></span>
<span id="cb3-11"><a href="r.html#cb3-11" tabindex="-1"></a>  )</span></code></pre></div>
<p>We will also set the pseudo-random number generator seed to 02138 to make the stochastic components of our simulations reproducible.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="r.html#cb4-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">02138</span>)</span></code></pre></div>
</div>
<div id="data-simulation-step-by-step" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Data simulation step by step<a href="r.html#data-simulation-step-by-step" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s write some code that creates datasets under the alternative hypothesis.</p>
<div id="establish-the-data-generating-parameters" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Establish the data-generating parameters<a href="r.html#establish-the-data-generating-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="r.html#cb5-1" tabindex="-1"></a><span class="co"># set all data-generating parameters</span></span>
<span id="cb5-2"><a href="r.html#cb5-2" tabindex="-1"></a>beta_0  <span class="ot">&lt;-</span> <span class="dv">800</span>   <span class="co"># intercept; i.e., the grand mean</span></span>
<span id="cb5-3"><a href="r.html#cb5-3" tabindex="-1"></a>beta_1  <span class="ot">&lt;-</span>  <span class="dv">50</span>   <span class="co"># slope; i.e, effect of category</span></span>
<span id="cb5-4"><a href="r.html#cb5-4" tabindex="-1"></a>tau_0   <span class="ot">&lt;-</span> <span class="dv">100</span>   <span class="co"># by-subject random intercept sd</span></span>
<span id="cb5-5"><a href="r.html#cb5-5" tabindex="-1"></a>tau_1   <span class="ot">&lt;-</span>  <span class="dv">40</span>   <span class="co"># by-subject random slope sd</span></span>
<span id="cb5-6"><a href="r.html#cb5-6" tabindex="-1"></a>rho     <span class="ot">&lt;-</span>   <span class="fl">0.2</span> <span class="co"># correlation between intercept and slope</span></span>
<span id="cb5-7"><a href="r.html#cb5-7" tabindex="-1"></a>sigma   <span class="ot">&lt;-</span> <span class="dv">200</span>   <span class="co"># residual (error) sd</span></span></code></pre></div>
</div>
<div id="simulate-the-sampling-process" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Simulate the sampling process<a href="r.html#simulate-the-sampling-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="r.html#cb6-1" tabindex="-1"></a><span class="co"># set number of subjects and items</span></span>
<span id="cb6-2"><a href="r.html#cb6-2" tabindex="-1"></a>n_subj <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># number of subjects</span></span>
<span id="cb6-3"><a href="r.html#cb6-3" tabindex="-1"></a>n_pop  <span class="ot">&lt;-</span>  <span class="dv">25</span> <span class="co"># number of songs in pop category</span></span>
<span id="cb6-4"><a href="r.html#cb6-4" tabindex="-1"></a>n_rock <span class="ot">&lt;-</span>  <span class="dv">25</span> <span class="co"># number of songs in rock category</span></span></code></pre></div>
</div>
<div id="simulate-the-sampling-of-songs" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Simulate the sampling of songs<a href="r.html#simulate-the-sampling-of-songs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="r.html#cb7-1" tabindex="-1"></a><span class="co"># simulate a sample of songs</span></span>
<span id="cb7-2"><a href="r.html#cb7-2" tabindex="-1"></a>songs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb7-3"><a href="r.html#cb7-3" tabindex="-1"></a>  <span class="at">song_id =</span> <span class="fu">seq_len</span>(n_pop <span class="sc">+</span> n_rock),</span>
<span id="cb7-4"><a href="r.html#cb7-4" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;pop&quot;</span>, <span class="st">&quot;rock&quot;</span>), <span class="fu">c</span>(n_pop, n_rock)),</span>
<span id="cb7-5"><a href="r.html#cb7-5" tabindex="-1"></a>  <span class="at">genre_i =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(n_pop, n_rock))</span>
<span id="cb7-6"><a href="r.html#cb7-6" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="simulate-the-sampling-of-subjects" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Simulate the sampling of subjects<a href="r.html#simulate-the-sampling-of-subjects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will use the function <code>faux::rnorm_multi()</code>, which generates a table of <code>n</code> simulated values from a multivariate normal distribution by specifying the means (<code>mu</code>) and standard deviations (<code>sd</code>) of each variable, plus the correlations (<code>r</code>), which can be either a single value (applied to all pairs), a correlation matrix, or a vector of the values in the upper right triangle of the correlation matrix.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="r.html#cb8-1" tabindex="-1"></a><span class="co"># simulate a sample of subjects</span></span>
<span id="cb8-2"><a href="r.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="r.html#cb8-3" tabindex="-1"></a><span class="co"># sample from a multivariate normal distribution</span></span>
<span id="cb8-4"><a href="r.html#cb8-4" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> faux<span class="sc">::</span><span class="fu">rnorm_multi</span>(</span>
<span id="cb8-5"><a href="r.html#cb8-5" tabindex="-1"></a>    <span class="at">n =</span> n_subj,</span>
<span id="cb8-6"><a href="r.html#cb8-6" tabindex="-1"></a>    <span class="at">mu =</span> <span class="dv">0</span>, <span class="co"># means for random effects are always 0</span></span>
<span id="cb8-7"><a href="r.html#cb8-7" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(tau_0, tau_1), <span class="co"># set SDs</span></span>
<span id="cb8-8"><a href="r.html#cb8-8" tabindex="-1"></a>    <span class="at">r =</span> rho, <span class="co"># set correlation, see ?rnorm_multi</span></span>
<span id="cb8-9"><a href="r.html#cb8-9" tabindex="-1"></a>    <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;b_0j&quot;</span>, <span class="st">&quot;b_1j&quot;</span>)</span>
<span id="cb8-10"><a href="r.html#cb8-10" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="r.html#cb8-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> <span class="fu">seq_len</span>(n_subj)) <span class="co"># add subject IDs</span></span></code></pre></div>
</div>
<div id="check-the-simulated-values" class="section level3 hasAnchor" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Check the simulated values<a href="r.html#check-the-simulated-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="r.html#cb9-1" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb9-2"><a href="r.html#cb9-2" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">&quot;tau_0&quot;</span>, <span class="st">&quot;tau_1&quot;</span>, <span class="st">&quot;rho&quot;</span>),</span>
<span id="cb9-3"><a href="r.html#cb9-3" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(tau_0, tau_1, rho),</span>
<span id="cb9-4"><a href="r.html#cb9-4" tabindex="-1"></a>  <span class="at">simulated =</span> <span class="fu">c</span>(</span>
<span id="cb9-5"><a href="r.html#cb9-5" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>b_0j),</span>
<span id="cb9-6"><a href="r.html#cb9-6" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>b_1j),</span>
<span id="cb9-7"><a href="r.html#cb9-7" tabindex="-1"></a>    <span class="fu">cor</span>(subjects<span class="sc">$</span>b_0j, subjects<span class="sc">$</span>b_1j)</span>
<span id="cb9-8"><a href="r.html#cb9-8" tabindex="-1"></a>  )</span>
<span id="cb9-9"><a href="r.html#cb9-9" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   parameter value simulated
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 tau_0     100     100.   
## 2 tau_1      40      39.2  
## 3 rho         0.2     0.116</code></pre>
</div>
<div id="simulate-trials" class="section level3 hasAnchor" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Simulate trials<a href="r.html#simulate-trials" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="r.html#cb11-1" tabindex="-1"></a><span class="co"># cross subject and song IDs; add an error term</span></span>
<span id="cb11-2"><a href="r.html#cb11-2" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">crossing</span>(subjects, songs) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="r.html#cb11-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_ij =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span></code></pre></div>
</div>
<div id="calculate-response-values" class="section level3 hasAnchor" number="4.2.7">
<h3><span class="header-section-number">4.2.7</span> Calculate response values<a href="r.html#calculate-response-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="r.html#cb12-1" tabindex="-1"></a>dat_sim <span class="ot">&lt;-</span> trials <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="r.html#cb12-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">liking_ij =</span> beta_0 <span class="sc">+</span> b_0j <span class="sc">+</span> (beta_1 <span class="sc">+</span> b_1j) <span class="sc">*</span> genre_i <span class="sc">+</span> e_ij) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="r.html#cb12-3" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, category, genre_i, liking_ij)</span></code></pre></div>
</div>
<div id="plot-the-data" class="section level3 hasAnchor" number="4.2.8">
<h3><span class="header-section-number">4.2.8</span> Plot the data<a href="r.html#plot-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="r.html#cb13-1" tabindex="-1"></a>dat_sim <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="r.html#cb13-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(category, liking_ij, <span class="at">color =</span> category)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="r.html#cb13-3" tabindex="-1"></a>  <span class="co"># predicted means</span></span>
<span id="cb13-4"><a href="r.html#cb13-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> (beta_0 <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>beta_1), </span>
<span id="cb13-5"><a href="r.html#cb13-5" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="r.html#cb13-6" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> (beta_0 <span class="sc">+</span> <span class="dv">1</span><span class="sc">*</span>beta_1), </span>
<span id="cb13-7"><a href="r.html#cb13-7" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="r.html#cb13-8" tabindex="-1"></a>  <span class="co"># actual data</span></span>
<span id="cb13-9"><a href="r.html#cb13-9" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="r.html#cb13-10" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom=</span><span class="st">&quot;crossbar&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="r.html#cb13-11" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-12"><a href="r.html#cb13-12" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted versus simulated values&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="r.html#cb13-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="figures/unnamed-chunk-8-1.png" width="768" /></p>
</div>
<div id="analyze-the-simulated-data" class="section level3 hasAnchor" number="4.2.9">
<h3><span class="header-section-number">4.2.9</span> Analyze the simulated data<a href="r.html#analyze-the-simulated-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="r.html#cb14-1" tabindex="-1"></a><span class="co"># fit a linear mixed-effects model to data</span></span>
<span id="cb14-2"><a href="r.html#cb14-2" tabindex="-1"></a>mod_sim <span class="ot">&lt;-</span> <span class="fu">lmer</span>(liking_ij <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> genre_i <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> genre_i <span class="sc">|</span> subj_id), <span class="at">data =</span> dat_sim)</span>
<span id="cb14-3"><a href="r.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="r.html#cb14-4" tabindex="-1"></a><span class="fu">summary</span>(mod_sim, <span class="at">corr =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: liking_ij ~ 1 + genre_i + (1 + genre_i | subj_id)
##    Data: dat_sim
## 
## REML criterion at convergence: 67393.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6245 -0.6466  0.0026  0.6804  3.1317 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  subj_id  (Intercept) 10510    102.52       
##           genre_i      1130     33.62   0.09
##  Residual             39481    198.70       
## Number of obs: 5000, groups:  subj_id, 100
## 
## Fixed effects:
##             Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)  804.651     10.995  98.995  73.183  &lt; 2e-16 ***
## genre_i       61.378      6.549  98.998   9.372 2.56e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Use <code>broom.mixed::tidy(mod_sim)</code> to get a tidy table of the results. Below, we added column “parameter” and “value”, so you can compare the estimate from the model to the parameters you used to simulate the data.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="r.html#cb16-1" tabindex="-1"></a><span class="co"># get a tidy table of results</span></span>
<span id="cb16-2"><a href="r.html#cb16-2" tabindex="-1"></a>broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod_sim) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="r.html#cb16-3" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="r.html#cb16-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-5"><a href="r.html#cb16-5" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">&quot;beta_0&quot;</span>, <span class="st">&quot;beta_1&quot;</span>, <span class="st">&quot;tau_0&quot;</span>, <span class="st">&quot;rho&quot;</span>, <span class="st">&quot;tau_1&quot;</span>, <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb16-6"><a href="r.html#cb16-6" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">c</span>(beta_0, beta_1, tau_0, rho, tau_1, sigma),</span>
<span id="cb16-7"><a href="r.html#cb16-7" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="r.html#cb16-8" tabindex="-1"></a>  <span class="fu">select</span>(term, parameter, value, estimate) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="r.html#cb16-9" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="left">parameter</th>
<th align="right">value</th>
<th align="right">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="left">beta_0</td>
<td align="right">800.0</td>
<td align="right">804.651</td>
</tr>
<tr class="even">
<td align="left">genre_i</td>
<td align="left">beta_1</td>
<td align="right">50.0</td>
<td align="right">61.378</td>
</tr>
<tr class="odd">
<td align="left">sd__(Intercept)</td>
<td align="left">tau_0</td>
<td align="right">100.0</td>
<td align="right">102.518</td>
</tr>
<tr class="even">
<td align="left">cor__(Intercept).genre_i</td>
<td align="left">rho</td>
<td align="right">0.2</td>
<td align="right">0.089</td>
</tr>
<tr class="odd">
<td align="left">sd__genre_i</td>
<td align="left">tau_1</td>
<td align="right">40.0</td>
<td align="right">33.620</td>
</tr>
<tr class="even">
<td align="left">sd__Observation</td>
<td align="left">sigma</td>
<td align="right">200.0</td>
<td align="right">198.698</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="data-simulation-automated" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Data simulation automated<a href="r.html#data-simulation-automated" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we’ve tested the data generating code, we can put it into a function so that it’s easy to run it repeatedly.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="r.html#cb17-1" tabindex="-1"></a><span class="co"># set up the custom data simulation function</span></span>
<span id="cb17-2"><a href="r.html#cb17-2" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb17-3"><a href="r.html#cb17-3" tabindex="-1"></a>  <span class="at">n_subj     =</span> <span class="dv">100</span>,   <span class="co"># number of subjects</span></span>
<span id="cb17-4"><a href="r.html#cb17-4" tabindex="-1"></a>  <span class="at">n_pop      =</span>  <span class="dv">25</span>,   <span class="co"># number of pop songs</span></span>
<span id="cb17-5"><a href="r.html#cb17-5" tabindex="-1"></a>  <span class="at">n_rock     =</span>  <span class="dv">25</span>,   <span class="co"># number of rock songs</span></span>
<span id="cb17-6"><a href="r.html#cb17-6" tabindex="-1"></a>  <span class="at">beta_0     =</span> <span class="dv">800</span>,   <span class="co"># grand mean</span></span>
<span id="cb17-7"><a href="r.html#cb17-7" tabindex="-1"></a>  <span class="at">beta_1     =</span>  <span class="dv">50</span>,   <span class="co"># effect of category</span></span>
<span id="cb17-8"><a href="r.html#cb17-8" tabindex="-1"></a>  <span class="at">tau_0      =</span> <span class="dv">100</span>,   <span class="co"># by-subject random intercept sd</span></span>
<span id="cb17-9"><a href="r.html#cb17-9" tabindex="-1"></a>  <span class="at">tau_1      =</span>  <span class="dv">40</span>,   <span class="co"># by-subject random slope sd</span></span>
<span id="cb17-10"><a href="r.html#cb17-10" tabindex="-1"></a>  <span class="at">rho        =</span>   <span class="fl">0.2</span>, <span class="co"># correlation between intercept and slope</span></span>
<span id="cb17-11"><a href="r.html#cb17-11" tabindex="-1"></a>  <span class="at">sigma      =</span> <span class="dv">200</span>)   <span class="co"># residual (standard deviation)</span></span>
<span id="cb17-12"><a href="r.html#cb17-12" tabindex="-1"></a>{</span>
<span id="cb17-13"><a href="r.html#cb17-13" tabindex="-1"></a>  <span class="co"># simulate a sample of songs</span></span>
<span id="cb17-14"><a href="r.html#cb17-14" tabindex="-1"></a>  songs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-15"><a href="r.html#cb17-15" tabindex="-1"></a>    <span class="at">song_id =</span> <span class="fu">seq_len</span>(n_pop <span class="sc">+</span> n_rock),</span>
<span id="cb17-16"><a href="r.html#cb17-16" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;pop&quot;</span>, <span class="st">&quot;rock&quot;</span>), <span class="fu">c</span>(n_pop, n_rock)),</span>
<span id="cb17-17"><a href="r.html#cb17-17" tabindex="-1"></a>    <span class="at">genre_i =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(n_pop, n_rock))</span>
<span id="cb17-18"><a href="r.html#cb17-18" tabindex="-1"></a>  )</span>
<span id="cb17-19"><a href="r.html#cb17-19" tabindex="-1"></a></span>
<span id="cb17-20"><a href="r.html#cb17-20" tabindex="-1"></a>  <span class="co"># simulate a sample of subjects</span></span>
<span id="cb17-21"><a href="r.html#cb17-21" tabindex="-1"></a>  subjects <span class="ot">&lt;-</span> faux<span class="sc">::</span><span class="fu">rnorm_multi</span>(</span>
<span id="cb17-22"><a href="r.html#cb17-22" tabindex="-1"></a>    <span class="at">n =</span> n_subj,</span>
<span id="cb17-23"><a href="r.html#cb17-23" tabindex="-1"></a>    <span class="at">mu =</span> <span class="dv">0</span>,</span>
<span id="cb17-24"><a href="r.html#cb17-24" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">c</span>(tau_0, tau_1),</span>
<span id="cb17-25"><a href="r.html#cb17-25" tabindex="-1"></a>    <span class="at">r =</span> rho,</span>
<span id="cb17-26"><a href="r.html#cb17-26" tabindex="-1"></a>    <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;b_0j&quot;</span>, <span class="st">&quot;b_1j&quot;</span>)</span>
<span id="cb17-27"><a href="r.html#cb17-27" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-28"><a href="r.html#cb17-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> <span class="fu">seq_len</span>(n_subj))</span>
<span id="cb17-29"><a href="r.html#cb17-29" tabindex="-1"></a></span>
<span id="cb17-30"><a href="r.html#cb17-30" tabindex="-1"></a><span class="co"># cross subject and song IDs</span></span>
<span id="cb17-31"><a href="r.html#cb17-31" tabindex="-1"></a><span class="fu">crossing</span>(subjects, songs) <span class="sc">|&gt;</span></span>
<span id="cb17-32"><a href="r.html#cb17-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_ij =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma),</span>
<span id="cb17-33"><a href="r.html#cb17-33" tabindex="-1"></a>         <span class="at">liking_ij =</span> beta_0 <span class="sc">+</span> b_0j <span class="sc">+</span> (beta_1 <span class="sc">+</span> b_1j) <span class="sc">*</span> genre_i <span class="sc">+</span> e_ij) <span class="sc">|&gt;</span></span>
<span id="cb17-34"><a href="r.html#cb17-34" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, category, genre_i, liking_ij)</span>
<span id="cb17-35"><a href="r.html#cb17-35" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="power-calculation-single-run" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Power calculation (single run)<a href="r.html#power-calculation-single-run" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can wrap the data generating function and analysis code in a new function (<code>power_run()</code>) that returns a tidy table of the analysis results.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="r.html#cb18-1" tabindex="-1"></a><span class="co"># set up the power function</span></span>
<span id="cb18-2"><a href="r.html#cb18-2" tabindex="-1"></a>power_run <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb18-3"><a href="r.html#cb18-3" tabindex="-1"></a>  <span class="co"># ... is a shortcut that forwards any additional arguments to sim_data()</span></span>
<span id="cb18-4"><a href="r.html#cb18-4" tabindex="-1"></a>  dat_sim <span class="ot">&lt;-</span> <span class="fu">sim_data</span>(...)</span>
<span id="cb18-5"><a href="r.html#cb18-5" tabindex="-1"></a>  mod_sim <span class="ot">&lt;-</span> <span class="fu">lmer</span>(liking_ij <span class="sc">~</span> genre_i <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> genre_i <span class="sc">|</span> subj_id), <span class="at">data =</span> dat_sim)</span>
<span id="cb18-6"><a href="r.html#cb18-6" tabindex="-1"></a>  broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod_sim)</span>
<span id="cb18-7"><a href="r.html#cb18-7" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="r.html#cb19-1" tabindex="-1"></a><span class="co"># run one model with default parameters</span></span>
<span id="cb19-2"><a href="r.html#cb19-2" tabindex="-1"></a><span class="fu">power_run</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   effect   group    term            estimate std.error statistic    df   p.value
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 fixed    &lt;NA&gt;     (Intercept)      795.         9.99     79.6   99.0  1.42e-91
## 2 fixed    &lt;NA&gt;     genre_i           57.9        6.97      8.30  99.0  5.51e-13
## 3 ran_pars subj_id  sd__(Intercept)   91.4       NA        NA     NA   NA       
## 4 ran_pars subj_id  cor__(Intercep…    0.425     NA        NA     NA   NA       
## 5 ran_pars subj_id  sd__genre_i       40.3       NA        NA     NA   NA       
## 6 ran_pars Residual sd__Observation  201.        NA        NA     NA   NA</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="r.html#cb21-1" tabindex="-1"></a><span class="co"># run one model with new parameters</span></span>
<span id="cb21-2"><a href="r.html#cb21-2" tabindex="-1"></a><span class="fu">power_run</span>(<span class="at">n_pop =</span> <span class="dv">50</span>, <span class="at">n_rock =</span> <span class="dv">45</span>, <span class="at">beta_1 =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   effect   group    term            estimate std.error statistic    df   p.value
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 fixed    &lt;NA&gt;     (Intercept)      805.        11.0      72.9   99.0  7.79e-88
## 2 fixed    &lt;NA&gt;     genre_i           25.8        5.61      4.60  99.0  1.25e- 5
## 3 ran_pars subj_id  sd__(Intercept)  107.        NA        NA     NA   NA       
## 4 ran_pars subj_id  cor__(Intercep…    0.174     NA        NA     NA   NA       
## 5 ran_pars subj_id  sd__genre_i       38.2       NA        NA     NA   NA       
## 6 ran_pars Residual sd__Observation  200.        NA        NA     NA   NA</code></pre>
</div>
<div id="power-calculation-automated" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Power calculation automated<a href="r.html#power-calculation-automated" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To get an accurate estimation of power, we need to run the simulation many times. We use 100 here as an example, but the results will be more accurate the more replications you run. This will depend on the specifics of your analysis, but we recommend at least 1000 replications.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="r.html#cb23-1" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb23-2"><a href="r.html#cb23-2" tabindex="-1"></a>sims <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span>reps, <span class="sc">~</span> <span class="fu">power_run</span>())</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="r.html#cb24-1" tabindex="-1"></a><span class="co"># calculate mean estimates and power for specified alpha</span></span>
<span id="cb24-2"><a href="r.html#cb24-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb24-3"><a href="r.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="r.html#cb24-4" tabindex="-1"></a>sims <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="r.html#cb24-5" tabindex="-1"></a>  <span class="fu">filter</span>(effect <span class="sc">==</span> <span class="st">&quot;fixed&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="r.html#cb24-6" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="r.html#cb24-7" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-8"><a href="r.html#cb24-8" tabindex="-1"></a>    <span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb24-9"><a href="r.html#cb24-9" tabindex="-1"></a>    <span class="at">mean_se =</span> <span class="fu">mean</span>(std.error),</span>
<span id="cb24-10"><a href="r.html#cb24-10" tabindex="-1"></a>    <span class="at">power =</span> <span class="fu">mean</span>(p.value <span class="sc">&lt;</span> alpha),</span>
<span id="cb24-11"><a href="r.html#cb24-11" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb24-12"><a href="r.html#cb24-12" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   term        mean_estimate mean_se power
##   &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 (Intercept)         799.    10.6      1
## 2 genre_i              51.3    6.86     1</code></pre>
<div id="check-false-positive-rate" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Check false positive rate<a href="r.html#check-false-positive-rate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Set the effect of <code>genre_ij</code> to 0 to calculate the false positive rate. This is the probability of concluding there is an effect when there is no actual effect in your population.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="r.html#cb26-1" tabindex="-1"></a><span class="co"># run simulations and calculate the false positive rate</span></span>
<span id="cb26-2"><a href="r.html#cb26-2" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb26-3"><a href="r.html#cb26-3" tabindex="-1"></a>sims_fp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span>reps, <span class="sc">~</span> <span class="fu">power_run</span>(<span class="at">beta_1 =</span> <span class="dv">0</span>))</span>
<span id="cb26-4"><a href="r.html#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="r.html#cb26-5" tabindex="-1"></a><span class="co"># calculate mean estimates and power for specified alpha</span></span>
<span id="cb26-6"><a href="r.html#cb26-6" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb26-7"><a href="r.html#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="r.html#cb26-8" tabindex="-1"></a>sims_fp <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a href="r.html#cb26-9" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;genre_i&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="r.html#cb26-10" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">power =</span> <span class="fu">mean</span>(p.value <span class="sc">&lt;</span> alpha))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   power
##   &lt;dbl&gt;
## 1  0.06</code></pre>
<p>Ideally, the false positive rate will be equal to alpha, which we set here at 0.05.</p>
</div>
</div>
<div id="power-for-different-effect-sizes" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Power for different effect sizes<a href="r.html#power-for-different-effect-sizes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In real life, we will not know the effect size of our quantity of interest and so we will need to repeatedly perform the power analysis over a range of different plausible effect sizes.</p>
<div id="summarize" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Summarize<a href="r.html#summarize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here’s the table from the simulation.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="r.html#cb28-1" tabindex="-1"></a>power_list <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="r.html#cb28-2" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="r.html#cb28-3" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title=</span><span class="st">&quot;Power values for GLM&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="r.html#cb28-4" tabindex="-1"></a>  <span class="fu">data_color</span>(</span>
<span id="cb28-5"><a href="r.html#cb28-5" tabindex="-1"></a>    <span class="at">columns=</span>power,</span>
<span id="cb28-6"><a href="r.html#cb28-6" tabindex="-1"></a>    <span class="at">colors=</span>scales<span class="sc">::</span><span class="fu">col_numeric</span>(</span>
<span id="cb28-7"><a href="r.html#cb28-7" tabindex="-1"></a>      <span class="at">palette=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb28-8"><a href="r.html#cb28-8" tabindex="-1"></a>      <span class="at">domain=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb28-9"><a href="r.html#cb28-9" tabindex="-1"></a>      )</span>
<span id="cb28-10"><a href="r.html#cb28-10" tabindex="-1"></a>  )</span></code></pre></div>
<p>Here’s the graph from the simulation.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="r.html#cb29-1" tabindex="-1"></a>power_list <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="r.html#cb29-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_n =</span> <span class="fu">factor</span>(sample_n)) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="r.html#cb29-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>interact_coef, <span class="at">y=</span>power, </span>
<span id="cb29-4"><a href="r.html#cb29-4" tabindex="-1"></a>             <span class="at">group=</span>sample_n, <span class="at">color=</span>sample_n)) <span class="sc">+</span> </span>
<span id="cb29-5"><a href="r.html#cb29-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb29-6"><a href="r.html#cb29-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb29-7"><a href="r.html#cb29-7" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-8"><a href="r.html#cb29-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="power-of-what.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="python.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/IQSS/dss-powersim/edit/master/04_R.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["dss-powersim.pdf", "dss-powersim.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
